<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicializador Base de Datos - EL TACHI</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        h1 {
            color: #1a73e8;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #5f6368;
            font-size: 18px;
        }

        .firebase-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .config-title {
            color: #1a73e8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .config-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #5f6368;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #1a73e8;
            outline: none;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #init-btn {
            background: #1a73e8;
            color: white;
        }

        #init-btn:hover {
            background: #0d47a1;
            transform: translateY(-2px);
        }

        #reset-btn {
            background: #f8f9fa;
            color: #5f6368;
            border: 2px solid #e0e0e0;
        }

        #reset-btn:hover {
            background: #e8eaed;
        }

        .status-panel {
            margin-top: 40px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .status-panel.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .status-item {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 5px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
        }

        .status-item.success {
            border-left-color: #34a853;
            background: #e8f6ee;
        }

        .status-item.error {
            border-left-color: #ea4335;
            background: #fce8e6;
        }

        .status-item.processing {
            border-left-color: #fbbc05;
            background: #fef7e0;
        }

        .status-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-text {
            flex: 1;
        }

        .status-time {
            color: #5f6368;
            font-size: 14px;
        }

        .step-counter {
            background: #1a73e8;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .instructions {
            background: #e8f0fe;
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
            border-left: 5px solid #1a73e8;
        }

        .instructions h3 {
            color: #1a73e8;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .warning {
            background: #fef7e0;
            border: 2px solid #fbbc05;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .download-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: #34a853;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: background 0.3s;
        }

        .download-btn:hover {
            background: #2e7d32;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üçî</div>
            <h1>EL TACHI - Inicializador de Base de Datos</h1>
            <p class="subtitle">Crea autom√°ticamente todas las colecciones y documentos en Firebase</p>
        </div>

        <div class="warning">
            <div style="font-size: 24px;">‚ö†Ô∏è</div>
            <div>
                <strong>ADVERTENCIA:</strong> Este script crear√°/modificar√° datos en tu proyecto Firebase.
                Aseg√∫rate de tener los permisos necesarios y de estar en el proyecto correcto.
            </div>
        </div>

        <div class="firebase-config">
            <h2 class="config-title">
                <span style="font-size: 24px;">üî•</span>
                Configuraci√≥n Firebase
            </h2>
            
            <div class="config-group">
                <label for="apiKey">API Key</label>
                <input type="text" id="apiKey" placeholder="AIzaSy...">
            </div>
            
            <div class="config-group">
                <label for="projectId">Project ID</label>
                <input type="text" id="projectId" placeholder="tu-proyecto-id">
            </div>
            
            <div class="buttons">
                <button id="init-btn">
                    <span id="spinner" class="spinner" style="display: none;"></span>
                    <span id="btn-text">üöÄ Inicializar Base de Datos</span>
                </button>
                <button id="reset-btn">
                    <span style="font-size: 20px;">üîÑ</span>
                    Limpiar Todo
                </button>
            </div>
        </div>

        <div class="status-panel" id="status-panel">
            <div class="status-header">
                <h3>Progreso de Inicializaci√≥n</h3>
                <div class="step-counter">
                    Paso <span id="current-step">0</span>/<span id="total-steps">8</span>
                </div>
            </div>
            <div id="status-list"></div>
        </div>

        <div class="instructions">
            <h3>üìã Pasos Previos Requeridos:</h3>
            <ol>
                <li>Crea un proyecto en <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                <li>Activa Firestore Database (modo prueba)</li>
                <li>Activa Authentication (m√©todo Email/Password)</li>
                <li>Configura las reglas de Firestore (usa las reglas temporales)</li>
                <li>Copia tu configuraci√≥n Firebase desde Configuraci√≥n del Proyecto</li>
            </ol>
            
            <a href="#rules" class="download-btn" onclick="showRules()">üìã Ver Reglas de Firestore</a>
        </div>
    </div>

    <!-- Modal para Reglas -->
    <div id="rules-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; padding: 20px;">
        <div style="background: white; padding: 30px; border-radius: 15px; max-width: 800px; max-height: 80vh; overflow-y: auto; width: 100%;">
            <h2 style="color: #1a73e8; margin-bottom: 20px;">Reglas de Firestore (Copia y Pega)</h2>
            <pre style="background: #f5f5f5; padding: 20px; border-radius: 8px; overflow-x: auto; line-height: 1.5;">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas temporales para desarrollo
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
            </pre>
            <button onclick="hideRules()" style="margin-top: 20px; padding: 12px 24px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
                Cerrar
            </button>
        </div>
    </div>

    <script>
        // Referencias a elementos DOM
        const apiKeyInput = document.getElementById('apiKey');
        const projectIdInput = document.getElementById('projectId');
        const initBtn = document.getElementById('init-btn');
        const resetBtn = document.getElementById('reset-btn');
        const statusPanel = document.getElementById('status-panel');
        const statusList = document.getElementById('status-list');
        const spinner = document.getElementById('spinner');
        const btnText = document.getElementById('btn-text');
        const currentStep = document.getElementById('current-step');
        const totalSteps = document.getElementById('total-steps');

        // Configurar Firebase autom√°ticamente desde los inputs
        function initializeFirebase() {
            const apiKey = apiKeyInput.value.trim();
            const projectId = projectIdInput.value.trim();
            
            if (!apiKey || !projectId) {
                showError('Por favor completa todos los campos de configuraci√≥n');
                return null;
            }
            
            try {
                const firebaseConfig = {
                    apiKey: apiKey,
                    authDomain: `${projectId}.firebaseapp.com`,
                    projectId: projectId,
                    storageBucket: `${projectId}.appspot.com`,
                    messagingSenderId: "000000000000", // Placeholder
                    appId: "1:000000000000:web:000000000000"
                };
                
                // Inicializar Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                return firebase.firestore();
            } catch (error) {
                showError(`Error inicializando Firebase: ${error.message}`);
                return null;
            }
        }

        // Mostrar mensaje de estado
        function addStatus(message, type = 'processing') {
            const statusItem = document.createElement('div');
            statusItem.className = `status-item ${type}`;
            
            const icon = type === 'success' ? '‚úÖ' : 
                        type === 'error' ? '‚ùå' : 
                        type === 'warning' ? '‚ö†Ô∏è' : '‚è≥';
            
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            statusItem.innerHTML = `
                <div class="status-icon">${icon}</div>
                <div class="status-text">${message}</div>
                <div class="status-time">${time}</div>
            `;
            
            statusList.appendChild(statusItem);
            statusItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // Actualizar contador de pasos
            if (type === 'success') {
                const current = parseInt(currentStep.textContent);
                currentStep.textContent = current + 1;
            }
        }

        // Mostrar error
        function showError(message) {
            addStatus(`ERROR: ${message}`, 'error');
            initBtn.disabled = false;
            btnText.textContent = 'üöÄ Reintentar';
            spinner.style.display = 'none';
        }

        // Funci√≥n para inicializar base de datos
        async function initializeDatabase() {
            // Mostrar panel de estado
            statusPanel.classList.add('active');
            statusList.innerHTML = '';
            currentStep.textContent = '0';
            totalSteps.textContent = '8';
            
            // Deshabilitar bot√≥n y mostrar spinner
            initBtn.disabled = true;
            spinner.style.display = 'block';
            btnText.textContent = 'Inicializando...';
            
            // Inicializar Firebase
            addStatus('Inicializando conexi√≥n con Firebase...');
            const db = initializeFirebase();
            if (!db) return;
            
            addStatus('Conexi√≥n exitosa con Firebase', 'success');
            
            try {
                // ========================
                // 1. CREAR COLECCI√ìN: settings
                // ========================
                addStatus('Creando configuraci√≥n del negocio...');
                
                const settingsData = {
                    horarios: {
                        lunes: { abierto: true, inicio: "10:00", cierre: "23:00" },
                        martes: { abierto: true, inicio: "10:00", cierre: "23:00" },
                        miercoles: { abierto: true, inicio: "10:00", cierre: "23:00" },
                        jueves: { abierto: true, inicio: "10:00", cierre: "23:00" },
                        viernes: { abierto: true, inicio: "10:00", cierre: "00:00" },
                        sabado: { abierto: true, inicio: "11:00", cierre: "00:00" },
                        domingo: { abierto: true, inicio: "11:00", cierre: "22:00" },
                        cerrado_mensaje: "Cerrado. Abrimos ma√±ana a las 10:00 AM"
                    },
                    envios: {
                        precio: 300,
                        tiempo_min: 30,
                        tiempo_max: 45,
                        retiro_habilitado: true,
                        radio_entrega_km: 5
                    },
                    negocio: {
                        nombre: "EL TACHI",
                        telefono: "+5491112345678",
                        direccion: "Av. Principal 1234",
                        abierto: true,
                        email: "contacto@eltachi.com",
                        instagram: "@eltachi.ok"
                    },
                    gemini_config: {
                        api_key: "TU_API_KEY_AQUI", // Reemplazar luego
                        modelo: "gemini-pro",
                        temperatura: 0.7
                    }
                };
                
                for (const [docId, data] of Object.entries(settingsData)) {
                    await db.collection('settings').doc(docId).set(data);
                }
                addStatus('Configuraci√≥n creada exitosamente', 'success');
                
                // ========================
                // 2. CREAR COLECCI√ìN: products
                // ========================
                addStatus('Creando productos del men√∫...');
                
                const products = [
                    {
                        id: "hamburguesa-clasica",
                        nombre: "Hamburguesa Cl√°sica",
                        descripcion: "Carne 180g, queso cheddar, tomate, lechuga, cebolla",
                        precio: 2500,
                        disponible: true,
                        categoria: "hamburguesas",
                        aderezos_disponibles: ["mayonesa", "ketchup", "mostaza", "salsa especial"],
                        precios_extra_aderezos: { "salsa especial": 50 },
                        imagen: "hamburguesa.jpg",
                        orden: 1,
                        destacado: true
                    },
                    {
                        id: "hamburguesa-doble",
                        nombre: "Hamburguesa Doble",
                        descripcion: "Doble carne, doble queso, panceta, huevo",
                        precio: 3200,
                        disponible: true,
                        categoria: "hamburguesas",
                        aderezos_disponibles: ["mayonesa", "ketchup", "barbacoa", "salsa especial"],
                        precios_extra_aderezos: { "salsa especial": 50, "barbacoa": 30 },
                        imagen: "hamburguesa-doble.jpg",
                        orden: 2,
                        destacado: true
                    },
                    {
                        id: "papas-fritas",
                        nombre: "Papas Fritas",
                        descripcion: "Porci√≥n grande con sal y perejil",
                        precio: 1200,
                        disponible: true,
                        categoria: "acompa√±amientos",
                        aderezos_disponibles: ["ketchup", "mayonesa", "salsa verde"],
                        precios_extra_aderezos: {},
                        imagen: "papas.jpg",
                        orden: 3
                    },
                    {
                        id: "papas-cheddar",
                        nombre: "Papas con Cheddar",
                        descripcion: "Papas fritas con cheddar y panceta",
                        precio: 1800,
                        disponible: true,
                        categoria: "acompa√±amientos",
                        aderezos_disponibles: [],
                        precios_extra_aderezos: {},
                        imagen: "papas-cheddar.jpg",
                        orden: 4
                    },
                    {
                        id: "gaseosa-coca",
                        nombre: "Coca-Cola 500ml",
                        descripcion: "Gaseosa Coca-Cola",
                        precio: 800,
                        disponible: true,
                        categoria: "bebidas",
                        aderezos_disponibles: [],
                        precios_extra_aderezos: {},
                        imagen: "coca.jpg",
                        orden: 5
                    },
                    {
                        id: "agua-mineral",
                        nombre: "Agua Mineral 500ml",
                        descripcion: "Agua sin gas",
                        precio: 500,
                        disponible: true,
                        categoria: "bebidas",
                        aderezos_disponibles: [],
                        precios_extra_aderezos: {},
                        imagen: "agua.jpg",
                        orden: 6
                    },
                    {
                        id: "pizza-muzzarella",
                        nombre: "Pizza Muzzarella",
                        descripcion: "Pizza con muzzarella y salsa de tomate",
                        precio: 2800,
                        disponible: true,
                        categoria: "pizzas",
                        aderezos_disponibles: ["or√©gano", "aj√≠ molido", "aceitunas"],
                        precios_extra_aderezos: { "aceitunas": 100 },
                        imagen: "pizza-muzza.jpg",
                        orden: 7
                    },
                    {
                        id: "pizza-napolitana",
                        nombre: "Pizza Napolitana",
                        descripcion: "Pizza con muzzarella, tomate y albahaca",
                        precio: 3200,
                        disponible: true,
                        categoria: "pizzas",
                        aderezos_disponibles: ["or√©gano", "aj√≠ molido"],
                        precios_extra_aderezos: {},
                        imagen: "pizza-napo.jpg",
                        orden: 8
                    }
                ];
                
                for (const product of products) {
                    await db.collection('products').doc(product.id).set(product);
                }
                addStatus(`${products.length} productos creados exitosamente`, 'success');
                
                // ========================
                // 3. CREAR COLECCI√ìN: categories
                // ========================
                addStatus('Creando categor√≠as...');
                
                const categories = [
                    { id: "hamburguesas", nombre: "Hamburguesas", orden: 1, visible: true },
                    { id: "pizzas", nombre: "Pizzas", orden: 2, visible: true },
                    { id: "sandwiches", nombre: "S√°ndwiches", orden: 3, visible: true },
                    { id: "acompa√±amientos", nombre: "Acompa√±amientos", orden: 4, visible: true },
                    { id: "bebidas", nombre: "Bebidas", orden: 5, visible: true },
                    { id: "postres", nombre: "Postres", orden: 6, visible: true }
                ];
                
                for (const category of categories) {
                    await db.collection('categories').doc(category.id).set(category);
                }
                addStatus(`${categories.length} categor√≠as creadas`, 'success');
                
                // ========================
                // 4. CREAR COLECCI√ìN: counters
                // ========================
                addStatus('Creando contadores...');
                
                await db.collection('counters').doc('orders').set({
                    count: 0,
                    last_update: firebase.firestore.FieldValue.serverTimestamp()
                });
                addStatus('Contador de pedidos creado', 'success');
                
                // ========================
                // 5. CREAR COLECCI√ìN: admins
                // ========================
                addStatus('Creando usuarios administradores...');
                
                await db.collection('admins').doc('admin@eltachi.com').set({
                    email: "admin@eltachi.com",
                    nombre: "Administrador Principal",
                    rol: "superadmin",
                    activo: true,
                    creado: firebase.firestore.FieldValue.serverTimestamp()
                });
                addStatus('Usuario admin creado', 'success');
                
                // ========================
                // 6. CREAR USUARIO EN AUTHENTICATION
                // ========================
                addStatus('Creando usuario en Authentication...');
                
                try {
                    const email = "admin@eltachi.com";
                    const password = "Admin123!";
                    
                    // Intentar crear usuario
                    await firebase.auth().createUserWithEmailAndPassword(email, password);
                    addStatus('Usuario de authentication creado: admin@eltachi.com / Admin123!', 'success');
                } catch (authError) {
                    if (authError.code === 'auth/email-already-in-use') {
                        addStatus('Usuario ya existe en Authentication', 'warning');
                    } else {
                        addStatus(`Nota: Debes crear manualmente el usuario en Authentication: admin@eltachi.com`, 'warning');
                    }
                }
                
                // ========================
                // 7. CREAR PEDIDO DE EJEMPLO
                // ========================
                addStatus('Creando pedido de ejemplo...');
                
                const exampleOrder = {
                    id_pedido: "TACHI-000001",
                    fecha: firebase.firestore.FieldValue.serverTimestamp(),
                    cliente: "Cliente de Prueba",
                    telefono: "+5491111111111",
                    tipo: "retiro",
                    direccion: "",
                    pedido_detallado: "- Hamburguesa Cl√°sica x1\n- Papas Fritas x1\n- Coca-Cola 500ml x1",
                    total: 4500,
                    estado: "Entregado",
                    notas: "Pedido de ejemplo para testing"
                };
                
                await db.collection('orders').doc(exampleOrder.id_pedido).set(exampleOrder);
                addStatus('Pedido de ejemplo creado', 'success');
                
                // ========================
                // 8. VERIFICACI√ìN FINAL
                // ========================
                addStatus('Realizando verificaci√≥n final...');
                
                // Contar documentos creados
                const collections = ['settings', 'products', 'categories', 'counters', 'admins', 'orders'];
                let totalDocs = 0;
                
                for (const collection of collections) {
                    const snapshot = await db.collection(collection).get();
                    totalDocs += snapshot.size;
                }
                
                addStatus(`‚úÖ ¬°BASE DE DATOS INICIALIZADA EXITOSAMENTE!`, 'success');
                addStatus(`üìä Total: ${totalDocs} documentos creados en ${collections.length} colecciones`, 'success');
                
                // Mostrar resumen
                const summary = document.createElement('div');
                summary.className = 'status-item success';
                summary.style.background = '#e8f6ee';
                summary.innerHTML = `
                    <div class="status-icon">üéâ</div>
                    <div class="status-text">
                        <strong>RESUMEN COMPLETO:</strong><br>
                        ‚Ä¢ 4 documentos en "settings"<br>
                        ‚Ä¢ 8 productos en "products"<br>
                        ‚Ä¢ 6 categor√≠as en "categories"<br>
                        ‚Ä¢ 1 contador en "counters"<br>
                        ‚Ä¢ 1 usuario en "admins"<br>
                        ‚Ä¢ 1 pedido en "orders"<br>
                        <br>
                        <strong>Credenciales de acceso:</strong><br>
                        ‚Ä¢ Email: admin@eltachi.com<br>
                        ‚Ä¢ Contrase√±a: Admin123!<br>
                        <br>
                        <strong>Pr√≥ximos pasos:</strong><br>
                        1. Ve a Authentication y habilita Email/Password<br>
                        2. Agrega el usuario admin@eltachi.com<br>
                        3. Configura las reglas de Firestore
                    </div>
                `;
                statusList.appendChild(summary);
                
                // Habilitar bot√≥n
                initBtn.disabled = false;
                btnText.textContent = '‚úÖ ¬°Completado!';
                spinner.style.display = 'none';
                
                // Mostrar bot√≥n para ir al sistema
                const goToSystemBtn = document.createElement('button');
                goToSystemBtn.innerHTML = 'üöÄ Ir al Sistema EL TACHI';
                goToSystemBtn.style.cssText = `
                    margin-top: 20px;
                    padding: 15px 30px;
                    background: #34a853;
                    color: white;
                    border: none;
                    border-radius: 10px;
                    font-size: 18px;
                    font-weight: bold;
                    cursor: pointer;
                    width: 100%;
                    transition: background 0.3s;
                `;
                goToSystemBtn.onmouseover = () => goToSystemBtn.style.background = '#2e7d32';
                goToSystemBtn.onmouseout = () => goToSystemBtn.style.background = '#34a853';
                goToSystemBtn.onclick = () => {
                    window.open('/index.html', '_blank');
                };
                
                statusPanel.appendChild(goToSystemBtn);
                
            } catch (error) {
                showError(`Error en la inicializaci√≥n: ${error.message}`);
                console.error('Error detallado:', error);
            }
        }

        // Funci√≥n para limpiar base de datos (CUIDADO)
        async function resetDatabase() {
            if (!confirm('‚ö†Ô∏è ¬°ADVERTENCIA! Esto eliminar√° TODOS los datos de Firestore. ¬øEst√°s seguro?')) {
                return;
            }
            
            const db = initializeFirebase();
            if (!db) return;
            
            initBtn.disabled = true;
            statusPanel.classList.add('active');
            statusList.innerHTML = '';
            
            addStatus('Iniciando limpieza de base de datos...', 'warning');
            
            try {
                // Lista de colecciones a limpiar
                const collections = ['settings', 'products', 'categories', 'orders', 'counters', 'admins'];
                
                for (const collectionName of collections) {
                    addStatus(`Eliminando colecci√≥n: ${collectionName}...`);
                    
                    const snapshot = await db.collection(collectionName).get();
                    const batch = db.batch();
                    
                    snapshot.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    await batch.commit();
                    addStatus(`Colecci√≥n ${collectionName} eliminada`, 'success');
                }
                
                addStatus('‚úÖ Base de datos limpiada completamente', 'success');
                
            } catch (error) {
                showError(`Error al limpiar: ${error.message}`);
            } finally {
                initBtn.disabled = false;
            }
        }

        // Funci√≥n para mostrar reglas
        function showRules() {
            document.getElementById('rules-modal').style.display = 'flex';
        }

        function hideRules() {
            document.getElementById('rules-modal').style.display = 'none';
        }

        // Event Listeners
        initBtn.addEventListener('click', initializeDatabase);
        resetBtn.addEventListener('click', resetDatabase);

        // Cargar configuraci√≥n desde localStorage si existe
        window.addEventListener('load', () => {
            const savedApiKey = localStorage.getItem('firebase_apiKey');
            const savedProjectId = localStorage.getItem('firebase_projectId');
            
            if (savedApiKey) apiKeyInput.value = savedApiKey;
            if (savedProjectId) projectIdInput.value = savedProjectId;
            
            // Guardar autom√°ticamente al escribir
            apiKeyInput.addEventListener('input', () => {
                localStorage.setItem('firebase_apiKey', apiKeyInput.value);
            });
            
            projectIdInput.addEventListener('input', () => {
                localStorage.setItem('firebase_projectId', projectIdInput.value);
            });
        });

        // Cerrar modal al hacer clic fuera
        document.getElementById('rules-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideRules();
            }
        });
    </script>
</body>
</html>
