<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Admin - EL TACHI</title>
    <link rel="stylesheet" href="css/admin.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Chart.js para grÃ¡ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="logo-admin">ğŸ”</div>
            <h1>EL TACHI - Panel Admin</h1>
            <p>Acceso restringido al personal autorizado</p>
            
            <div class="login-form">
                <input type="email" id="loginEmail" placeholder="Correo electrÃ³nico" autocomplete="email">
                <input type="password" id="loginPassword" placeholder="ContraseÃ±a" autocomplete="current-password">
                <button onclick="login()">ğŸ” Iniciar SesiÃ³n</button>
                <button onclick="register()" class="secondary">ğŸ“ Registrar Nuevo Admin</button>
            </div>
            
            <div id="loginError" class="error-message"></div>
        </div>
    </div>

    <!-- Main Admin Panel (hidden until login) -->
    <div id="adminPanel" class="admin-panel" style="display: none;">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <div class="logo-small">ğŸ”</div>
                <h1>Panel Admin <span id="storeName">EL TACHI</span></h1>
            </div>
            <div class="header-right">
                <span id="userEmail"></span>
                <button onclick="logout()" class="logout-btn">ğŸšª Cerrar SesiÃ³n</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="admin-nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">ğŸ“Š Dashboard</button>
            <button class="nav-btn" onclick="showSection('orders')">ğŸ“¦ Pedidos</button>
            <button class="nav-btn" onclick="showSection('products')">ğŸ” Productos</button>
            <button class="nav-btn" onclick="showSection('categories')">ğŸ—‚ CategorÃ­as</button>
            <button class="nav-btn" onclick="showSection('settings')">âš™ï¸ ConfiguraciÃ³n</button>
            <button class="nav-btn" onclick="showSection('reports')">ğŸ“ˆ Reportes</button>
        </nav>

        <!-- Main Content -->
        <main class="admin-content">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <h2>ğŸ“Š Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Pedidos Hoy</h3>
                        <p id="ordersToday">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Estado Local</h3>
                        <p id="storeStatus">Cargando...</p>
                    </div>
                    <div class="stat-card">
                        <h3>Ventas Totales</h3>
                        <p id="totalSales">$0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Productos Activos</h3>
                        <p id="activeProducts">0</p>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>Pedidos por Hora (Ãšltimas 24h)</h3>
                    <canvas id="ordersChart"></canvas>
                </div>
                
                <div class="recent-orders">
                    <h3>ğŸ“‹ Pedidos Recientes</h3>
                    <div id="recentOrdersList" class="orders-list">
                        <!-- Se cargan dinÃ¡micamente -->
                    </div>
                </div>
            </section>

            <!-- Orders Management -->
            <section id="orders" class="section">
                <h2>ğŸ“¦ GestiÃ³n de Pedidos</h2>
                
                <div class="filters">
                    <select id="orderFilter" onchange="filterOrders()">
                        <option value="all">Todos los pedidos</option>
                        <option value="today">Hoy</option>
                        <option value="pending">Pendientes</option>
                        <option value="preparation">En preparaciÃ³n</option>
                        <option value="ready">Listos</option>
                    </select>
                    <button onclick="refreshOrders()" class="refresh-btn">ğŸ”„ Actualizar</button>
                </div>
                
                <div id="ordersList" class="orders-list detailed">
                    <!-- Pedidos se cargan aquÃ­ -->
                </div>
            </section>

            <!-- Products Management -->
            <section id="products" class="section">
                <h2>ğŸ” GestiÃ³n de Productos</h2>
                
                <div class="section-header">
                    <button onclick="showProductModal()" class="add-btn">â• Agregar Producto</button>
                    <input type="text" id="productSearch" placeholder="Buscar producto..." oninput="searchProducts()">
                </div>
                
                <div id="productsList" class="products-grid">
                    <!-- Productos se cargan aquÃ­ -->
                </div>
            </section>

            <!-- Categories -->
            <section id="categories" class="section">
                <h2>ğŸ—‚ GestiÃ³n de CategorÃ­as</h2>
                <!-- Contenido de categorÃ­as -->
            </section>

            <!-- Settings -->
            <section id="settings" class="section">
                <h2>âš™ï¸ ConfiguraciÃ³n del Local</h2>
                <!-- Formulario de configuraciÃ³n -->
            </section>

            <!-- Reports -->
            <section id="reports" class="section">
                <h2>ğŸ“ˆ Reportes y ExportaciÃ³n</h2>
                <!-- Reportes y exportaciÃ³n -->
            </section>
        </main>
    </div>

    <!-- Modales -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <h2>Detalle del Pedido <span id="modalOrderId"></span></h2>
            <!-- Contenido dinÃ¡mico -->
            <button onclick="closeModal('orderModal')" class="close-btn">âœ• Cerrar</button>
        </div>
    </div>

    <div id="productModal" class="modal">
        <!-- Modal de producto -->
    </div>

    <!-- Scripts -->
    <script src="js/firebase-init.js"></script>
    <script src="js/admin-panel.js"></script>
    
    <script>
        // Inicializar cuando cargue la pÃ¡gina
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si ya estÃ¡ logueado
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    showAdminPanel(user);
                } else {
                    document.getElementById('loginScreen').style.display = 'flex';
                }
            });
        });
    </script>
</body>
</html>
